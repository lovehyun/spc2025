from langchain_core.prompts import ChatPromptTemplate, HumanMessagePromptTemplate
from langchain_openai import ChatOpenAI
from dotenv import load_dotenv

from langchain_core.runnables import RunnableLambda

load_dotenv()

# template = "다음의 글을 3문장으로 요약하시오:\n\n{article}"

# 원샷 러닝
template = "다음의 글을 3문장으로 요약하시오. 각 줄은 50글자 이하로 작성하시오.: \n\n본문: {article}"
# template = "다음의 글을 3문장으로 요약하시오. 각 줄은 50글자 이하로 작성하시오. 이 글의 제목을 신문기사에 사람들의 이목을 이끌수 있는 과정된 형태로 제목을 붙여줘.:\n\n예) 신문제목: xxx\n하나. xxx\n둘. xxx\n셋. xxx\n\n본문: {article}"

prompt = ChatPromptTemplate.from_messages(
    [
        HumanMessagePromptTemplate.from_template(template)
    ]
)
# 모델 바꿔보기... gpt-3.5-turbo, gpt-4o, gpt-4o-mini
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0.5) # 요약이 목적이니 정확하게...

chain = prompt | llm | RunnableLambda(lambda x: {"summary": x.content.strip()}) # 주의 (기존 x 에서 chat모드에서는 x.content 에 담겨서 옴)

input_text = {
    "article": """
인류가 태양계를 벗어난 건 단지 86년 전이었다. 하지만 그날, 지구에서 42광년 떨어진 '트리톤-5b'의 하늘 아래서, 나는 인간이라는 존재가 얼마나 작은지를 절감했다.
나는 ‘스펙트라’ 함선의 천문학자, 리안 박사. 임무는 인근 성단에서 중성자별 충돌의 흔적을 추적해 그 잔해 속에서 원시 생명의 조건을 찾는 것이었다. 우리는 VLT(매우 큰 망원경)를 우주 공간에 직접 설치하고, 전자기파 스펙트럼을 분석하며 수천만 년 전의 폭발을 추적했다.
그러던 중, 우리가 관측한 중성자별의 충돌 잔해에서 이상한 주기성을 띤 신호가 감지되었다. 그것은 단순한 방사선이 아니었다. 신호는 정확히 3.141초마다 반복되었고, 신호 강도는 황금비로 점차 감소했다. 수학적 아름다움이 담긴 주파수라니, 이건 자연이 만든 게 아니라, ‘누군가’가 보낸 인공 신호일지도 모른다는 소름 돋는 결론에 도달했다.
우리 팀은 신호가 향하는 방향, 그 별의 위치를 ‘트리톤-7’이라 명명하고, 긴급히 탐사선을 보냈다. 그곳에서 우리는 행성 표면에 남겨진 거대한 정육각형 구조물을 발견했다. 구조물은 스스로 빛을 내며, 우리 관측기를 향해 ‘눈을 마주친 듯한’ 반응을 보였다.
그날 이후로, 나는 별들을 단순한 가스 구름이나 중력 덩어리가 아닌, 우주의 언어로 보기 시작했다. 어쩌면 천문학은 그저 숫자와 공식을 넘은, ‘대화의 시작’일지도 모른다.
    """
}

input_숙소후기_text = {
"""
조용한 마을 한복판에 있어 힐링 그 자체였어요. 창밖으로 보이는 풍경이 액자 같았습니다.
호스트분이 정말 친절하셨어요! 체크인 전에 미리 히터도 틀어주셔서 따뜻하게 쉴 수 있었습니다.
침대가 폭신하고 이불도 푹신해서 정말 꿀잠 잤어요. 다음에 또 오고 싶네요.
숙소는 예뻤지만 냉장고 안에 물이 없는 점은 아쉬웠어요. 기본 생수 정도는 있으면 좋겠어요.
커피 머신이 있어서 아침에 향긋한 커피 한 잔 마실 수 있었던 게 너무 좋았어요!
도심에서 살짝 떨어져 있지만 덕분에 밤하늘 별이 너무 잘 보여 감동이었습니다.
사진보다 더 예쁜 숙소였어요. 특히 테라스가 너무 마음에 들었습니다.
주차공간이 협소해서 처음에 약간 불편했지만, 숙소 자체는 정말 깨끗하고 좋았습니다.
주변에 맛집이 많아서 숙소에 머무는 동안 계속 배불렀어요 ㅎㅎ
호스트가 여행 팁도 알려주시고, 근처 관광지도 지도에 표시해주셔서 정말 감사했어요.
숙소는 깔끔했지만 수건 수량이 조금 부족했던 게 아쉬웠어요. 그래도 바로 추가 요청하니 챙겨주셨어요.
친구들과 단체로 갔는데 거실이 넓어서 보드게임하며 놀기 딱이었어요!
가성비 최고입니다. 이 가격에 이런 뷰라니 믿기 힘들 정도예요.
와이파이 속도가 빨라서 재택근무 중에도 불편함 없이 잘 머물렀습니다.
숙소 바로 옆에 편의점이 있어서 늦은 밤에도 간식 사오기 쉬웠어요.
바닥이 온돌이라 한겨울에도 발 시리지 않아서 너무 좋았어요.
고양이 한 마리가 가끔 마당에 놀러와서 힐링됐어요. 동물 좋아하는 분들께 추천해요!
인테리어가 빈티지하면서도 아늑해서 인생샷도 많이 남겼어요 📸
숙소 주변 산책로가 잘 되어 있어서 아침 산책하기에 정말 좋았어요.
체크아웃 시간이 10시라 조금 아쉬웠지만, 숙소 상태가 워낙 좋아서 충분히 만족했습니다.
"""
}

input_숙소후기_악플포함_text = {
"""
사진이랑 완전 달라요. 낡고 청소도 제대로 안 돼 있었어요. 두 번 다시 안 갑니다.
밤새 위층에서 쿵쾅거리는 소리 때문에 잠도 못 잤어요. 방음 전혀 안 돼요.
벌레 나왔어요… 진짜 너무 놀랐고 호스트는 그냥 사과만 하고 끝났네요.
냄새가 너무 심해서 도착하자마자 창문 열고 환기부터 했어요.
히터가 고장 났는데 밤에 연락도 안 받고 춥게 잤습니다. 최악이에요.
주방기구가 다 낡고 기름때가 있어서 음식 해먹기 찝찝했어요.
체크인 안내가 너무 불친절했어요. 연락도 늦게 답장 오고 당황했네요.
수건이랑 침구에서 세탁 안 된 냄새 났어요. 깔끔한 걸 기대했는데 실망이 큽니다.
옆 방 소음 때문에 쉬러 갔다가 더 스트레스 받고 왔네요.
기대하고 갔는데 너무 좁고 답답했어요. 사진 각도 조심하세요.
모든 게 완벽했어요! 사진보다 훨씬 예쁘고 아늑했어요.
호스트가 친절하게 응대해주셔서 기분 좋게 머물렀습니다.
청결도 최고, 위치도 최고! 또 예약하고 싶어요.
테라스에서 보는 일몰이 정말 환상적이었어요.
숙소에 들어서는 순간부터 힐링되는 기분이었어요. 향기도 좋았어요.
아이와 함께 머물기에도 안전하고 쾌적했어요. 가족 단위 강력 추천!
침구가 호텔급으로 푹신하고 포근해서 숙면했어요.
근처 카페랑 맛집 정보까지 안내해주셔서 너무 좋았어요.
체크인부터 체크아웃까지 너무 매끄러워서 감동이었어요.
조용하고 프라이빗한 분위기 덕분에 정말 잘 쉬고 왔습니다.
"""
}

result = chain.invoke(input_text)
# result = chain.invoke(input_숙소후기_text)
# result = chain.invoke(input_숙소후기_악플포함_text)

print("요약결과는:")
print(result['summary'])
